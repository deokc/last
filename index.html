<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>최후의 졸업생 | Application</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Noto+Sans+KR:wght@300;700&family=Courier+Prime&display=swap');

        :root {
            --primary: #ff003c;
            --bg: #050505;
            --surface: #121212;
            --text: #e0e0e0;
            --accent: #00f2ff;
            --warning: #ffea00;
        }

        body, html {
            margin: 0; padding: 0;
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Noto Sans KR', sans-serif;
            overflow: hidden;
        }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.05), rgba(0, 255, 0, 0.02), rgba(0, 255, 0, 0.05));
            z-index: 5000; background-size: 100% 4px, 3px 100%; pointer-events: none;
        }

        /* --- [BGM CONTROL] --- */
        #bgm-container {
            position: fixed; top: 20px; right: 20px; z-index: 8000;
            background: rgba(0, 0, 0, 0.7); padding: 10px 15px;
            border: 1px solid var(--primary); display: flex; align-items: center; gap: 10px;
            font-family: 'Orbitron'; font-size: 0.7rem; color: var(--primary);
            backdrop-filter: blur(5px); display: none;
        }
        #bgm-container input[type=range] {
            width: 80px; accent-color: var(--primary); cursor: pointer;
        }
        #bgm-btn {
            background: none; border: 1px solid var(--primary); color: var(--primary);
            cursor: pointer; padding: 2px 8px; font-size: 0.6rem;
        }

        /* --- [INTRO & AUTH] --- */
        #intro-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #2a0000 0%, #050505 100%);
            z-index: 4000; display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: transform 1.2s cubic-bezier(0.8, 0, 0.2, 1);
        }

        #welcome-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 4500;
            display: none; justify-content: center; align-items: center;
            font-family: 'Orbitron', 'Noto Sans KR';
            color: var(--accent); font-size: 2rem; letter-spacing: 5px;
            text-shadow: 0 0 15px var(--accent);
        }

        .auth-container {
            margin-top: 50px; display: flex; flex-direction: column; align-items: center; gap: 20px;
        }

        #user-name-input {
            background: rgba(0,0,0,0.5); border: 1px solid var(--primary);
            color: white; padding: 10px 20px; font-family: 'Courier Prime';
            text-align: center; font-size: 1.2rem; outline: none;
            display: none; 
        }

        .glitch-title {
            font-family: 'Orbitron', sans-serif; font-size: clamp(3rem, 10vw, 8rem);
            font-weight: 900; color: white; position: relative; text-transform: uppercase;
        }

        .glitch-title::after {
            content: "최후의 졸업생"; position: absolute; top: 0; left: -2px;
            text-shadow: 2px 0 var(--primary); background: transparent;
            overflow: hidden; clip: rect(0, 900px, 0, 0);
            animation: glitch-anim 2s infinite linear alternate-reverse;
        }

        @keyframes glitch-anim {
            0% { clip: rect(10px, 9999px, 50px, 0); transform: skew(0.5deg); }
            20% { clip: rect(80px, 9999px, 100px, 0); transform: skew(-1deg); }
            100% { clip: rect(10px, 9999px, 100px, 0); }
        }

        .auth-btn {
            padding: 15px 50px;
            background: transparent; color: var(--primary); border: 2px solid var(--primary);
            font-family: 'Orbitron', sans-serif; font-weight: bold; cursor: pointer;
            letter-spacing: 3px; transition: 0.3s; animation: pulse 1.5s infinite;
        }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,0,60,0.4); } 70% { box-shadow: 0 0 0 20px rgba(255,0,60,0); } 100% { box-shadow: 0 0 0 0 rgba(255,0,60,0); } }
        .auth-btn:hover { background: var(--primary); color: white; }

        /* --- [MAIN SITE] --- */
        #main-site { display: none; height: 100vh; flex-direction: column; }
        nav { background: rgba(0,0,0,0.9); display: flex; justify-content: center; gap: 15px; padding: 15px; border-bottom: 2px solid var(--primary); }
        nav button { background: none; border: 1px solid transparent; color: #888; padding: 10px 25px; cursor: pointer; font-family: 'Orbitron'; font-size: 0.8rem; transition: 0.3s; }
        nav button.active { color: var(--primary); border-color: var(--primary); background: rgba(255,0,60,0.1); }
        .content-area { flex: 1; overflow-y: auto; padding: 40px 20px; }
        .tab-content { display: none; max-width: 1000px; margin: 0 auto; animation: slideUp 0.4s ease-out; }
        .tab-content.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- [SURVIVOR CARD EFFECTS] --- */
        .survivor-card {
            background: var(--surface); 
            border: 1px solid #333; 
            cursor: pointer; 
            position: relative; 
            transition: 0.4s cubic-bezier(0.2, 1, 0.3, 1);
            overflow: hidden;
        }
        .survivor-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 0, 60, 0.2);
        }
        .survivor-card:hover img { transform: scale(1.1); }
        .survivor-card::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border: 2px solid var(--primary); opacity: 0; transition: 0.3s;
            box-sizing: border-box; z-index: 10; pointer-events: none;
        }
        .survivor-card:hover::before { opacity: 1; animation: focus-border 1.5s infinite; }
        @keyframes focus-border { 0%, 100% { clip-path: inset(0 0 0 0); } 50% { clip-path: inset(10% 10% 10% 10%); } }

        /* --- [TEST UI] --- */
        #test-container {
            background: var(--surface); padding: 40px; border: 1px solid #333; position: relative;
            min-height: 400px;
        }
        .test-option {
            width: 100%; padding: 15px; background: rgba(255,255,255,0.02);
            border: 1px solid #333; color: #ccc; text-align: left; cursor: pointer;
            margin-bottom: 10px; transition: 0.2s; font-family: 'Noto Sans KR';
        }
        .test-option:hover {
            border-color: var(--accent); color: var(--accent); background: rgba(0, 242, 255, 0.05);
        }
        #progress-bar { width: 100%; height: 2px; background: #222; margin-bottom: 30px; }
        #progress-inner { width: 0%; height: 100%; background: var(--accent); transition: 0.3s; box-shadow: 0 0 10px var(--accent); }

        /* --- [MAP & MODALS] --- */
        .map-container { perspective: 1500px; padding: 50px 0; display: flex; flex-direction: column; align-items: center; gap: 40px; }
        .building-main { display: flex; flex-direction: column-reverse; gap: 30px; }
        .floor-level { width: 750px; height: 160px; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.1); position: relative; transform: rotateX(55deg) rotateZ(-15deg); transition: 0.5s; display: grid; grid-template-rows: 1fr 35px 1fr; padding: 15px; gap: 10px; }
        .floor-level:hover { transform: rotateX(45deg) rotateZ(-15deg) translateZ(40px); border-color: var(--primary); background: rgba(255, 0, 60, 0.05); }
        .floor-label { position: absolute; left: -100px; top: 40%; transform: rotateZ(15deg) rotateX(-45deg); font-family: 'Orbitron'; color: var(--primary); font-size: 2.5rem; font-weight: 900; }
        .room-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .room { border: 1px solid rgba(255, 255, 255, 0.15); display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: #888; font-weight: bold; background: rgba(0,0,0,0.5); cursor: pointer; transition: 0.2s; }
        .room:hover { border-color: var(--accent); color: var(--accent); background: rgba(0, 242, 255, 0.05); }
        .corridor { grid-column: 1 / -1; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.2); display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: #666; cursor: pointer; transition: 0.3s; letter-spacing: 2px; font-weight: bold; }
        .corridor:hover { background: rgba(0, 242, 255, 0.1); color: var(--accent); border-color: var(--accent); }
        .external-area { display: flex; gap: 40px; margin-top: 20px; transform: rotateX(45deg) rotateZ(-15deg); }
        .out-building { border: 1px solid #444; background: rgba(20,20,20,0.8); display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; transition: 0.3s; color: #777; }
        .out-building:hover { border-color: var(--primary); color: var(--primary); }
        .gym { width: 250px; height: 180px; }
        .field { width: 420px; height: 160px; }

        /* CCTV & RECORD MODAL */
        #cctv-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 7000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .cctv-frame { width: 80%; max-width: 750px; border: 2px solid var(--primary); position: relative; overflow: hidden; }
        .cctv-frame img { width: 100%; display: block; filter: none; }
        .noise-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: url('https://upload.wikimedia.org/wikipedia/commons/7/76/1k_whitenoisetv.gif'); opacity: 0.1; pointer-events: none; mix-blend-mode: screen; }
        .scanlines { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.3) 50%); background-size: 100% 4px; pointer-events: none; }
        .static-line { position: absolute; width: 100%; height: 2px; background: rgba(255, 255, 255, 0.2); top: 0; animation: scan 3s infinite linear; opacity: 0.5; }
        @keyframes scan { 0% { top: -10%; } 100% { top: 110%; } }
        .cctv-data { background: var(--surface); padding: 20px; font-family: 'Courier Prime'; border-top: 2px solid var(--primary); position: relative; }
        .cctv-data::before { content: "REC ●"; position: absolute; top: 20px; right: 20px; color: var(--primary); animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        #modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 6000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        #record-paper { width: 90%; max-width: 800px; background: #0a0a0a; color: var(--text); padding: 50px; position: relative; font-family: 'Courier Prime', 'Noto Sans KR', serif; box-shadow: 0 0 50px rgba(255,0,60,0.2); border: 1px solid var(--primary); }
        .classified-stamp { position: absolute; bottom: 40px; right: 40px; border: 3px solid var(--primary); color: var(--primary); padding: 10px 20px; font-weight: 900; font-size: 1.5rem; transform: rotate(-15deg); opacity: 0.4; font-family: 'Orbitron'; letter-spacing: 5px; pointer-events: none; }
        .paper-header { border-bottom: 2px solid var(--primary); margin-bottom: 30px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: flex-end; }
        .paper-header h2 { margin: 0; font-size: 2.2rem; letter-spacing: 5px; font-weight: 900; font-family: 'Orbitron'; color: var(--primary); }
        .profile-section { display: grid; grid-template-columns: 200px 1fr; gap: 30px; }
        .photo-box { width: 200px; height: 260px; border: 2px solid #444; background: #000; overflow: hidden; position: relative; }
        .photo-box img { width: 100%; height: 100%; object-fit: cover; filter: none; transition: 0.5s; }
        .photo-box::after { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: var(--primary); box-shadow: 0 0 10px var(--primary); animation: photo-scan 3s infinite linear; }
        @keyframes photo-scan { 0% { top: 0%; } 100% { top: 100%; } }
        .info-table { width: 100%; border-collapse: collapse; }
        .info-table th, .info-table td { border: 1px solid #333; padding: 15px; text-align: left; }
        .info-table th { background: rgba(255, 0, 60, 0.1); width: 100px; font-weight: 700; color: var(--primary); }
        .info-table td { color: #fff; }
        .note-area { margin-top: 30px; border: 1px solid #333; padding: 20px; min-height: 150px; background: rgba(255,255,255,0.02); line-height: 1.8; }
        .note-area h4 { margin-top: 0; border-bottom: 1px solid var(--primary); display: inline-block; color: var(--accent); }
        .close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 2rem; cursor: pointer; color: var(--primary); opacity: 0.6; }
    </style>
</head>
<body>

    <div class="overlay"></div>

    <div id="bgm-container">
        <span>BGM_SIGNAL:</span>
        <button id="bgm-btn" onclick="toggleBGM()">OFF</button>
        <input type="range" id="vol-control" min="0" max="1" step="0.1" value="0.5" oninput="setVolume(this.value)">
    </div>
    <audio id="main-bgm" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3" type="audio/mpeg">
    </audio>

    <section id="intro-layer">
        <div class="glitch-title">최후의 졸업생</div>
        <div style="font-family: 'Orbitron'; color: var(--primary); margin-top: 10px; letter-spacing: 5px;">SURVIVORS: 80 / 80</div>
        
        <div class="auth-container">
            <input type="text" id="user-name-input" placeholder="이름을 입력하세요">
            <button class="auth-btn" id="access-btn" onclick="showInput()">입장 ACCESS</button>
        </div>
    </section>

    <div id="welcome-screen"></div>

    <main id="main-site">
        <nav>
            <button onclick="showTab('world')" id="btn-world" class="active">세계관/설정</button>
            <button onclick="showTab('test')" id="btn-test">능력 테스트</button>
            <button onclick="showTab('survivors')" id="btn-survivors">등장인물</button>
            <button onclick="showTab('sectors')" id="btn-sectors">구역</button>
        </nav>

        <div class="content-area">
            <div id="world" class="tab-content active">
                <h2 style="color:var(--primary); font-family:'Orbitron';">>> 최후의 졸업생</h2>
                <div style="background:var(--surface); padding:30px; border:1px solid #333; line-height:1.8;">
                    <h3 style="color:var(--accent); border-bottom: 1px solid #333; padding-bottom: 10px; font-family:'Orbitron';">시스템_설정</h3>
                    <p>2030년, 루미나시티 시내에 위치한 <b>'루미나 고등학교'</b>. 어느 날 밤 10시, 학교에 남은 모든 학생의 스마트폰에 정체불명의 앱 <b>[최후의 졸업생]</b>이 강제 설치되었습니다. 참가자들은 최후의 1인에게 주어지는 <b>'소원 성취권'</b>을 쟁취하기 위해 서로를 탈락시켜야 합니다.</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 25px;">
                        <div style="background: rgba(255,0,60,0.05); padding: 20px; border-left: 3px solid var(--primary);">
                            <h4 style="margin-top: 0; color: var(--primary);">▣ 생명 연동 시스템</h4>
                            <p style="font-size: 0.9rem; color: #ccc;">휴대폰이 물리적으로 파괴되면 소유자는 즉시 사망합니다. 배터리가 0%가 되는 것 또한 죽음을 의미합니다.</p>
                        </div>
                        <div style="background: rgba(0,242,255,0.05); padding: 20px; border-left: 3px solid var(--accent);">
                            <h4 style="margin-top: 0; color: var(--accent);">▣ 빅데이터 능력 부여</h4>
                            <p style="font-size: 0.9rem; color: #ccc;">SNS, 검색 기록 등을 분석해 가장 적합한 능력을 부여합니다. 일기 형식의 미래 예지부터 물리적 속박까지 다양합니다.</p>
                        </div>
                    </div>
                    <div style="margin-top: 25px; padding: 20px; border: 1px dashed #555; background: rgba(0,0,0,0.3);">
                        <h4 style="margin: 0 0 10px 0; color: var(--warning); font-family:'Orbitron';">⚠️ DEAD END (데드 엔드)</h4>
                        <p style="font-size: 0.9rem;">학교를 벗어나려 하거나 룰 위반 시, 즉시 '데드 엔드' 플래그가 뜹니다. 휴대폰 즉시 파괴, 일정시간 위치노출, 능력봉인 등 다양한 형태로 나타납니다.</p>
                        <h4 style="margin: 20px 0 10px 0; color: var(--warning); font-family:'Orbitron';">⚡ CHARGE ZONE (충전 구역)</h4>
                        <p style="font-size: 0.9rem;">오직 특정 구역의 콘센트만이 활성화됩니다. 한정된 에너지를 차지하기 위한 구역 점령전이 발생합니다.</p>
                    </div>
                </div>
            </div>

            <div id="test" class="tab-content">
                <h2 style="color:var(--primary); font-family:'Orbitron';">>> 잠재_능력_식별_테스트</h2>
                <div id="test-container">
                    <div id="test-intro">
                        <p style="color:var(--accent); line-height:1.6;">본 테스트는 귀하의 평소 행동 패턴과 데이터 기록을 분석하여 최적의 생존 능력을 할당합니다. <br>성실히 답변해주십시오.</p>
                        <button class="auth-btn" onclick="startTestProcess()">테스트 시작 START</button>
                    </div>
                    <div id="test-screen" style="display:none;">
                        <div id="progress-bar"><div id="progress-inner"></div></div>
                        <h3 id="question-text" style="color:white; margin-bottom:20px;">분석 중...</h3>
                        <div id="options-container"></div>
                    </div>
                    <div id="result-screen" style="display:none; text-align:center;">
                        <h3 style="color:var(--warning); font-family:'Orbitron';">분석 결과: ANALYSIS COMPLETE</h3>
                        <div id="final-ability-name" style="font-size:2.5rem; color:var(--primary); font-weight:900; margin:20px 0; text-shadow: 0 0 15px var(--primary);">능력명</div>
                        <p id="final-ability-desc" style="line-height:1.8; color:#ccc; max-width:600px; margin:0 auto 30px;"></p>
                        <button class="auth-btn" onclick="applyTestResult()">데이터 저장 및 프로필 갱신</button>
                    </div>
                </div>
            </div>

            <div id="survivors" class="tab-content">
                <h2 style="color:var(--primary); font-family:'Orbitron';">>> 참가자_명단</h2>
                <div id="survivor-grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:25px;"></div>
            </div>

            <div id="sectors" class="tab-content">
                <h2 style="color:var(--primary); font-family:'Orbitron';">>> 루미나_고등학교_구역</h2>
                <div class="map-container">
                    <div class="building-main">
                        <div class="floor-level"><div class="floor-label">1F</div><div class="room-grid"><div class="room" onclick="viewCCTV('보건실', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%B3%B4%EA%B1%B4%EC%8B%A401.png', '의료 비품 산재됨.')">보건실</div><div class="room" onclick="viewCCTV('교무실', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음.')">교무실</div><div class="room" onclick="viewCCTV('행정실', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음. 잠겨있음.')">행정실</div><div class="room" onclick="viewCCTV('교실 1-4', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음.')">교실 1-4</div></div><div class="corridor" onclick="viewCCTV('1층 복도', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%B3%B5%EB%8F%8401.png', '정적 유지.')">1F 복도</div><div class="room-grid"><div class="room" onclick="viewCCTV('교실 1-1', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EA%B5%90%EC%8B%A402.png', '책상 파손.')">교실 1-1</div><div class="room" onclick="viewCCTV('교실 1-2', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EA%B5%90%EC%8B%A401.png', '창문 봉쇄됨.')">교실 1-2</div><div class="room" onclick="viewCCTV('급식실', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음. 식자재 약탈됨.')">급식실</div><div class="room" onclick="viewCCTV('교실 1-3', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음.')">교실 1-3</div></div></div>
                        <div class="floor-level"><div class="floor-label">2F</div><div class="room-grid"><div class="room" onclick="viewCCTV('방송실', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%B0%A9%EC%86%A1%EC%8B%A401.png', '마이크 활성화 중.')">방송실</div><div class="room" onclick="viewCCTV('교실 2-1', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EA%B5%90%EC%8B%A404.png', '조용함.')">교실 2-1</div><div class="room" onclick="viewCCTV('교실 2-2', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EA%B5%90%EC%8B%A404.png', '흔적 감지.')">교실 2-2</div><div class="room" onclick="viewCCTV('교실 2-3', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음. 잠겨있음.')">교실 2-3</div></div><div class="corridor" onclick="viewCCTV('2층 복도', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%B3%B5%EB%8F%8402.png', '신호 불안정.')">2F 복도</div><div class="room-grid"><div class="room" onclick="viewCCTV('도서실', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음.')">도서실</div><div class="room" onclick="viewCCTV('과학실', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음. 약품 냄새.')">과학실</div><div class="room" onclick="viewCCTV('미술실', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음. 파손된 조각상.')">미술실</div><div class="room" onclick="viewCCTV('교실 2-4', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음. 특이사항 없음.')">교실 2-4</div></div></div>
                        <div class="floor-level"><div class="floor-label">3F</div><div class="room-grid"><div class="room" onclick="viewCCTV('교실 3-1', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EA%B5%90%EC%8B%A403.png', '이상 없음.')">교실 3-1</div><div class="room" onclick="viewCCTV('교실 3-2', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음. 잠겨있음.')">교실 3-2</div><div class="room" onclick="viewCCTV('교실 3-3', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EA%B5%90%EC%8B%A403.png', '인기척이 느껴짐.')">교실 3-3</div><div class="room" onclick="viewCCTV('교실 3-4', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음. 문 파손.')">교실 3-4</div></div><div class="corridor" onclick="viewCCTV('3층 복도', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%B3%B5%EB%8F%8401.png', '시야 오염됨.')">3F 복도</div><div class="room-grid"><div class="room" onclick="viewCCTV('컴퓨터실', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EC%BB%B4%ED%93%A8%ED%84%B0%EC%8B%A401.png', '서버 활성화.')">컴퓨터실</div><div class="room" onclick="viewCCTV('음악실', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EC%9D%8C%EC%95%85%EC%8B%A401.png', '소음 감지됨.')">음악실</div><div class="room" onclick="viewCCTV('상담실', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음. 잠겨있음.')">상담실</div><div class="room" style="border-color:var(--primary); color:var(--primary);" onclick="viewCCTV('옥상', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EC%98%A5%EC%83%8101.png', '강풍 발생.')">옥상</div></div></div>
                    </div>
                    <div class="external-area"><div class="out-building field" onclick="viewCCTV('운동장', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%85%B8%EC%8B%9C%EA%B7%B8%EB%84%9001.png', '신호 없음. 사각지대 없음.')">운동장</div><div class="out-building gym" onclick="viewCCTV('체육관', 'https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EC%B2%B4%EC%9C%A1%EA%B4%8001.png', '대규모 집결지. 환기구 폐쇄.')">체육관</div></div>
                </div>
            </div>
        </div>
    </main>

    <div id="cctv-modal" onclick="closeCCTV()"><div class="cctv-frame" onclick="event.stopPropagation()"><img id="cctv-img" src=""><div class="noise-overlay"></div><div class="scanlines"></div><div class="static-line"></div><div class="cctv-data"><h3 id="cctv-title" style="margin-bottom:10px; color:var(--primary);"></h3><p id="cctv-desc" style="font-size:0.9rem; line-height:1.4; color:#aaa;"></p><p style="font-size:0.8rem; margin-top:15px; color:#555;">[CAM_042] STATUS: LIVE</p></div></div></div>
    
    <div id="modal-overlay" onclick="closeRecord()"><div id="record-paper" onclick="event.stopPropagation()"><div class="classified-stamp">AUTHORIZED ONLY</div><button class="close-btn" onclick="closeRecord()">&times;</button><div class="paper-header"><h2>참가자_프로필</h2><div style="font-size:0.8rem; font-weight:bold; color:#555;">DATA_INDEX: 2030-EXP-42</div></div><div class="profile-section"><div class="photo-box"><img id="rec-img" src=""></div><table class="info-table"><tr><th>NAME</th><td id="rec-name"></td></tr><tr><th>AGE</th><td id="rec-age"></td></tr><tr><th>ABILITY</th><td id="rec-ability" style="color:var(--primary); font-weight:900;"></td></tr></table></div><div class="note-area"><h4>OBSERVATION / 특이사항</h4><div id="rec-note"></div></div><div style="margin-top:20px; text-align:right; font-size:0.9rem; border-top:1px solid #333; padding-top:10px; color:#555;"><b>EXPERIMENTAL_SERVER: RUMINA_HIGH_SCHOOL</b></div></div></div>

    <script>
        const survivorData = [
            { name: "서주희", age: "19", ability: "방해금지 모드 (일시적으로 동작금지, 능력봉쇄시킴)", note: "전교 회장. 카리스마와 친절함을 동시에 갖춘 완벽주의자. 야자하다가 강제로 참가됨.", img: "https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EC%84%9C%EC%A3%BC%ED%9D%AC01.png" },
            { name: "이도윤", age: "19", ability: "비행기 모드 (자신을 세계에서 로그아웃 시킴)", note: "전교 부회장. 기본적으로 차분하고 조용함. 야자하다가 강제로 참가됨.", img: "https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EC%9D%B4%EB%8F%84%EC%9C%A401.png" },
            { name: "한재우", age: "19", ability: "서열 강제 (대상에게 명령을 강제로 내림)", note: "일진. 전형적인 강약약강. 일진 무리들과 놀다가 강제로 참가됨.", img: "https://raw.githubusercontent.com/deokc/last/refs/heads/main/%ED%95%9C%EC%9E%AC%EC%9A%B001.png" },
            { name: "사토 유키", age: "18", ability: "타임랩스 (주변의 흐름을 초고속으로 압축하여 인지)", note: "2학년. 쿨하고 현실적. 검도부 동아리 활동하다가 강제로 참가됨.", img: "https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EC%82%AC%ED%86%A0%20%EC%9C%A0%ED%82%A401.png" },
            { name: "권우아", age: "18", ability: "아우라 렌즈 (상대의 감정 상태 색깔이 보임)", note: "송태민의 여자친구. 공주님 스타일. 학교에서 데이트 하다가 강제로 참가됨.", img: "https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EA%B6%8C%EC%9A%B0%EC%95%8401.png" },
            { name: "배시원", age: "19", ability: "사운드 아카이브 (소리가 자동으로 녹음되고 저장됨)", note: "3학년. 소심하고 내성적. 도서관에서 책을 읽다가 강제로 참가됨.", img: "https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%B0%B0%EC%8B%9C%EC%9B%9001.png" },
            { name: "남궁호", age: "18", ability: "천리안 (관측, 시각공유 가능)", note: "중2병. 허세가 심함. 옥상에서 혼자 포즈 잡다가 강제로 참가됨.", img: "https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%82%A8%EA%B6%81%ED%98%B801.png" },
            { name: "송태민", age: "18", ability: "우아 일기 (권우아에 관한 일들이 메시지로 전송됨)", note: "권우아의 남자친구. 선하고 다정다감. 권우아에게는 헌신적. 학교에서 데이트 하다가 강제로 참가됨.", img: "https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EC%86%A1%ED%83%9C%EB%AF%BC01.png" },
            { name: "문가은", age: "17", ability: "러브 앤 헤이트 (두 명의 참가자를 지정함)", note: "말광량이 멘헤라. 감정 기복 심함. 셀카 챌린지 하다가 강제로 참가됨.", img: "https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EB%AC%B8%EA%B0%80%EC%9D%8001.png" },
        ];

        let testQuestions = [
            { q: "앱이 설치된 직후, 당신이 가장 먼저 확인한 것은?", options: ["남은 배터리 양", "참가자 명단", "내 현재 위치", "채팅방 메시지", "앱의 설정 메뉴"], types: ["A", "B", "C", "D", "E"] },
            { q: "어두운 복도에서 낯선 인기척이 들린다면?", options: ["조용히 숨어서 지나가길 기다린다", "먼저 말을 걸어본다", "무기가 될만한 것을 찾는다", "휴대폰 조명을 켜서 확인한다", "반대 방향으로 도망친다"], types: ["A", "B", "C", "D", "E"] },
            { q: "가장 선호하는 학교 안의 장소는?", options: ["아무도 없는 도서실 깊숙한 곳", "넓고 트인 운동장", "모든 것을 지켜볼 수 있는 방송실", "간식이 있는 급식실", "누구에게도 방해받지 않는 옥상"], types: ["A", "B", "C", "D", "E"] },
            { q: "생존을 위해 가장 중요하다고 생각하는 덕목은?", options: ["냉철한 판단력", "동료와의 신뢰", "강인한 체력", "빠른 정보 수집", "운과 기회 포착"], types: ["A", "B", "C", "D", "E"] },
            { q: "마지막 한 명이 남아야 한다면, 당신은?", options: ["내가 되어야만 한다", "믿을 수 있는 사람과 함께 남고 싶다", "그냥 이 상황이 빨리 끝났으면 좋겠다", "상황에 따라 다를 것 같다", "끝까지 싸우다 명예롭게 탈락하겠다"], types: ["A", "B", "C", "D", "E"] }
        ];

        let abilityTypes = {
            "A": { name: "스텔스 모드", desc: "주변의 데이터 신호와 소음을 완전히 차단하여 타인의 레이더에서 완벽히 사라집니다." },
            "B": { name: "링크 커넥터", desc: "타인의 스마트폰에 일시적으로 접속하여 그들의 화면과 소리를 공유받을 수 있습니다." },
            "C": { name: "바이오 부스트", desc: "배터리를 소모하여 일시적으로 신체 능력을 극대화합니다. 폭발적인 힘을 냅니다." },
            "D": { name: "로그 마스터", desc: "과거의 기록을 추적하여 특정 구역에서 일어난 일을 텍스트 로그로 읽어낼 수 있습니다." },
            "E": { name: "랜덤 디버그", desc: "예측 불가능한 순간에 시스템 오류를 일으켜 주변 참가자들의 능력을 강제로 종료시킵니다." }
        };

        let currentQ = 0;
        let score = { "A":0, "B":0, "C":0, "D":0, "E":0 };
        let finalAbility = null;

        const bgm = document.getElementById('main-bgm');
        const bgmBtn = document.getElementById('bgm-btn');
        bgm.volume = 0.5;

        function toggleBGM() {
            if (bgm.paused) { bgm.play(); bgmBtn.innerText = "ON"; bgmBtn.style.color = "var(--accent)"; bgmBtn.style.borderColor = "var(--accent)"; } 
            else { bgm.pause(); bgmBtn.innerText = "OFF"; bgmBtn.style.color = "var(--primary)"; bgmBtn.style.borderColor = "var(--primary)"; }
        }
        function setVolume(val) { bgm.volume = val; }

        function showInput() {
            const btn = document.getElementById('access-btn');
            const input = document.getElementById('user-name-input');
            btn.innerText = "ACCESS CONFIRM"; btn.onclick = unlock;
            input.style.display = 'block'; input.focus();
        }

        function unlock() {
            const nameValue = document.getElementById('user-name-input').value.trim();
            if(!nameValue) { alert("식별을 위해 이름을 입력하십시오."); return; }

            bgm.play().catch(e => console.log("Autoplay blocked"));
            document.getElementById('bgm-container').style.display = 'flex';

            survivorData.unshift({
                name: nameValue,
                age: "??",
                ability: "데이터 분석 중...",
                note: "신규 참가자. 능력이 아직 할당되지 않았습니다. 테스트가 필요합니다.",
                img: "https://raw.githubusercontent.com/deokc/last/refs/heads/main/%EC%9C%A0%EC%A0%8000.png"
            });

            const welcome = document.getElementById('welcome-screen');
            const intro = document.getElementById('intro-layer');
            welcome.innerText = `환영합니다, ${nameValue} 참가자님.`;
            welcome.style.display = 'flex';

            setTimeout(() => {
                welcome.style.transition = 'opacity 0.8s';
                welcome.style.opacity = '0';
                intro.style.transform = 'translateY(-100%)';
                setTimeout(() => {
                    welcome.style.display = 'none';
                    document.getElementById('main-site').style.display = 'flex';
                    renderSurvivors();
                }, 800);
            }, 1500);
        }

        function renderSurvivors() {
            const grid = document.getElementById('survivor-grid');
            grid.innerHTML = survivorData.map((s, idx) => `
                <div class="survivor-card" onclick="openRecordByIndex(${idx})">
                    <div style="height:200px; background:#222; overflow:hidden;">
                        <img src="${s.img}" style="width:100%; height:100%; object-fit:cover; transition:0.5s;">
                    </div>
                    <div style="padding:20px; position:relative; z-index:5;">
                        <h3 style="margin:0; transition:0.3s; color:white;">${s.name} (${s.age})</h3>
                        <div style="font-family:'Orbitron'; font-size:0.7rem; color:var(--primary); margin-top:5px; opacity:0; transition:0.3s;" class="target-locked">TARGET_LOCKED</div>
                    </div>
                </div>
            `).join('');

            document.querySelectorAll('.survivor-card').forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.querySelector('.target-locked').style.opacity = '1';
                    card.querySelector('h3').style.color = 'var(--primary)';
                });
                card.addEventListener('mouseleave', () => {
                    card.querySelector('.target-locked').style.opacity = '0';
                    card.querySelector('h3').style.color = 'white';
                });
            });
        }

        function startTestProcess() {
            document.getElementById('test-intro').style.display = 'none';
            document.getElementById('test-screen').style.display = 'block';
            showQuestion();
        }

        function showQuestion() {
            if(currentQ >= testQuestions.length) {
                showResult();
                return;
            }
            let q = testQuestions[currentQ];
            document.getElementById('question-text').innerText = `Q${currentQ+1}. ${q.q}`;
            let container = document.getElementById('options-container');
            container.innerHTML = "";
            q.options.forEach((opt, idx) => {
                let btn = document.createElement('button');
                btn.className = "test-option";
                btn.innerText = opt;
                btn.onclick = () => {
                    score[q.types[idx]]++;
                    currentQ++;
                    document.getElementById('progress-inner').style.width = (currentQ / testQuestions.length * 100) + "%";
                    showQuestion();
                };
                container.appendChild(btn);
            });
        }

        function showResult() {
            document.getElementById('test-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            
            let maxType = Object.keys(score).reduce((a, b) => score[a] > score[b] ? a : b);
            finalAbility = abilityTypes[maxType];
            
            document.getElementById('final-ability-name').innerText = finalAbility.name;
            document.getElementById('final-ability-desc').innerText = finalAbility.desc;
        }

        function applyTestResult() {
            survivorData[0].ability = finalAbility.name;
            survivorData[0].note = `[데이터 분석 완료] ${finalAbility.desc}`;
            alert("능력 할당이 완료되었습니다. 프로필을 확인하십시오.");
            renderSurvivors();
            showTab('survivors');
        }

        function openRecordByIndex(index) {
            const s = survivorData[index];
            if(!s) return;
            document.getElementById('rec-name').innerText = s.name; 
            document.getElementById('rec-age').innerText = s.age;
            document.getElementById('rec-ability').innerText = s.ability; 
            document.getElementById('rec-img').src = s.img;
            document.getElementById('rec-note').innerText = s.note; 
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function showTab(tabId) { 
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active')); 
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active'); 
            document.getElementById('btn-' + tabId).classList.add('active');
        }
        function closeRecord() { document.getElementById('modal-overlay').style.display = 'none'; }
        function viewCCTV(title, img, desc) {
            document.getElementById('cctv-title').innerText = title; 
            document.getElementById('cctv-img').src = img;
            document.getElementById('cctv-desc').innerText = desc; 
            document.getElementById('cctv-modal').style.display = 'flex';
        }
        function closeCCTV() { document.getElementById('cctv-modal').style.display = 'none'; }
    </script>
</body>
</html>